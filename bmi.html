<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>BMI Records - Admin</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 min-h-screen flex">

<!-- ================= SIDEBAR ================= -->
<aside class="w-64 bg-white border-r flex flex-col min-h-screen">

  <div class="p-6 flex items-center gap-3 border-b">
    <img src="assets/logo_SmartHealth_Sense.png" class="h-20 w-20 object-contain">
    <span class="font-bold text-green-600 text-lg">Smart Health Sense</span>
  </div>

  <div class="px-6 py-4 border-b text-sm">
    <p class="text-gray-500">Login sebagai</p>
    <p id="admin-email" class="font-semibold text-gray-800">-</p>
    <span class="inline-block mt-1 text-xs bg-green-100 text-green-700 px-2 py-1 rounded">ADMIN</span>
  </div>

  <nav class="flex-1 p-4 space-y-2 text-sm">
    <a href="dashboard.html" class="block px-4 py-2 rounded-lg hover:bg-green-100">Dashboard</a>
    <a href="users.html" class="block px-4 py-2 rounded-lg hover:bg-green-100">Users</a>
    <a href="bmi.html" class="block px-4 py-2 rounded-lg hover:bg-green-100">BMI</a>
    <a href="feedback.html" class="block px-4 py-2 rounded-lg hover:bg-green-100">Feedback</a>
  </nav>

  <div class="p-4 border-t">
    <button onclick="logout()" class="w-full bg-red-500 hover:bg-red-600 text-white font-semibold py-2 rounded-lg">
      Logout
    </button>
  </div>
</aside>

<!-- ================= MAIN ================= -->
<main class="flex-1 p-8">

  <h1 class="text-3xl font-bold mb-6">BMI Records</h1>

  <div class="bg-white rounded shadow overflow-x-auto">
    <table class="w-full text-sm">
      <thead class="bg-gray-100">
        <tr>
          <th class="px-4 py-3 text-left">User ID</th>
          <th class="px-4 py-3 text-left">Email</th>
          <th class="px-4 py-3 text-left">BMI</th>
          <th class="px-4 py-3 text-left">Category</th>
          <th class="px-4 py-3 text-left">Tanggal</th>
        </tr>
      </thead>
      <tbody id="bmiTable">
        <tr>
          <td colspan="5" class="text-center py-6 text-gray-400">
            Memuat data...
          </td>
        </tr>
      </tbody>
    </table>
  </div>

</main>

<!-- ================= SCRIPT ================= -->
<script src="js/auth.js"></script>

<script>
  protectAdminPage();

  const token = localStorage.getItem("access_token");
  const user = JSON.parse(localStorage.getItem("user") || "{}");

  document.getElementById("admin-email").innerText =
    user.name && user.name.trim() !== "" ? user.name : user.email;

  document.addEventListener("DOMContentLoaded", fetchBMI);

  function fetchBMI() {
    fetch(`${API_BASE}/admin/bmi/latest`, {
      headers: { Authorization: `Bearer ${token}` }
    })
    .then(res => {
      if (!res.ok) throw new Error("Fetch gagal");
      return res.json();
    })
    .then(renderBMITable)
    .catch(() => showEmpty("Gagal memuat data BMI"));
  }

  function renderBMITable(data) {
    const tbody = document.getElementById("bmiTable");
    tbody.innerHTML = "";

    if (!data || data.length === 0) {
      showEmpty("Data BMI kosong");
      return;
    }

    data.forEach(item => {
      tbody.innerHTML += `
        <tr class="border-b">
          <td class="px-4 py-3">${item.user_id}</td>
          <td class="px-4 py-3">${item.email}</td>
          <td class="px-4 py-3 font-semibold">${item.bmi}</td>
          <td class="px-4 py-3">${item.category}</td>
          <td class="px-4 py-3 text-gray-500">
            ${new Date(item.created_at).toLocaleDateString("id-ID")}
          </td>
        </tr>
      `;
    });
  }

  function showEmpty(message) {
    document.getElementById("bmiTable").innerHTML = `
      <tr>
        <td colspan="5" class="text-center py-6 text-gray-400">${message}</td>
      </tr>
    `;
  }
</script>

</body>
</html>
